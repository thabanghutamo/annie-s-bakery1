{% extends "public/base.html" %}

{% block public_content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-6">
  <header class="mb-6 sm:mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">Blog</h1>
    
    <!-- Search and Filter -->
    <div class="flex flex-col sm:flex-row gap-4 mb-6">
      <div class="w-full sm:w-auto sm:flex-grow sm:max-w-md">
        <div class="relative">
          <input type="search" placeholder="Search posts..."
                 class="w-full px-4 py-2 pl-10 pr-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-pink-500"
                 oninput="filterPosts(this.value.toLowerCase())">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </div>
      {% if categories %}
      <div class="flex flex-wrap gap-2">
        <button class="px-3 sm:px-4 py-1.5 sm:py-2 text-sm sm:text-base rounded-full font-medium bg-pink-600 text-white" 
                onclick="filterByCategory('all')">All</button>
        {% for cat in categories %}
        <button class="px-3 sm:px-4 py-1.5 sm:py-2 text-sm sm:text-base rounded-full font-medium border border-pink-200 hover:border-pink-300 hover:bg-pink-50"
                onclick="filterByCategory('{{ cat }}')">{{ cat|title }}</button>
        {% endfor %}
      </div>
      {% endif %}
    </div>
  </header>

  <!-- Blog Posts Grid -->
  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 sm:gap-6" id="posts-grid">
    {% for post in posts %}
    <article class="bg-white rounded-lg shadow-sm overflow-hidden blog-post group hover:shadow-md transition-shadow"
             data-title="{{ post.title }}"
             data-description="{{ post.short_description }}"
             {% if post.categories %}data-categories="{{ post.categories|join(' ') }}"{% endif %}>
      {% if post.cover_image %}
      <div class="relative pb-[60%] sm:pb-[55%]">
        <img src="{{ post.cover_image }}" alt="{{ post.title }}" 
             class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
             loading="lazy">
      </div>
      {% endif %}
      <div class="p-3 sm:p-4">
        <h2 class="text-lg sm:text-xl font-semibold text-gray-900 group-hover:text-pink-600 transition-colors line-clamp-2">{{ post.title }}</h2>
        <p class="text-gray-500 text-xs sm:text-sm mt-1">{{ post.created_at|datetime }}</p>
        <p class="text-gray-600 mt-2 text-sm line-clamp-3">{{ post.short_description }}</p>
        <div class="mt-4">
          <a href="{{ url_for('public.blog_post', post_id=post.id) }}" 
             class="text-pink-600 hover:text-pink-700 text-sm font-medium">
            Read more â†’
          </a>
        </div>
      </div>
    </article>
    {% endfor %}
  </div>

  <!-- Empty State -->
  <div id="no-posts" class="hidden text-center py-12">
    <h3 class="text-lg font-medium text-gray-900">No posts found</h3>
    <p class="mt-2 text-gray-500">Try a different search term or category</p>
  </div>

  <!-- Pagination -->
  {% if pages > 1 %}
  <div class="mt-6 sm:mt-8 flex flex-wrap justify-center gap-2">
    {% if page > 1 %}
    <a href="{{ url_for('public.blog_page', page=page-1) }}"
       class="inline-flex items-center px-3 sm:px-4 py-1.5 sm:py-2 border border-pink-200 text-xs sm:text-sm font-medium rounded-md text-pink-700 bg-white hover:bg-pink-50">
      <svg class="mr-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
      </svg>
      Previous
    </a>
    {% endif %}

    {% for p in range(1, pages + 1) %}
    <a href="{{ url_for('public.blog_page', page=p) }}"
       class="inline-flex items-center px-4 py-2 border {% if p == page %}border-pink-500 bg-pink-50 text-pink-600{% else %}border-gray-300 text-gray-700 hover:bg-gray-50{% endif %} text-sm font-medium rounded-md">
      {{ p }}
    </a>
    {% endfor %}

    {% if page < pages %}
    <a href="{{ url_for('public.blog_page', page=page+1) }}"
       class="inline-flex items-center px-4 py-2 border border-pink-200 text-sm font-medium rounded-md text-pink-700 bg-white hover:bg-pink-50">
      Next
      <svg class="ml-2 h-5 w-5" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
        <path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" />
      </svg>
    </a>
    {% endif %}
  </div>
  {% endif %}
</div>

<script>
function filterPosts(query) {
  const posts = document.querySelectorAll('.blog-post');
  const noPostsMessage = document.getElementById('no-posts');
  let visibleCount = 0;

  posts.forEach(post => {
    const title = post.dataset.title.toLowerCase();
    const description = post.dataset.description.toLowerCase();
    const isVisible = title.includes(query) || description.includes(query);
    
    post.style.display = isVisible ? 'block' : 'none';
    if (isVisible) visibleCount++;
  });

  noPostsMessage.style.display = visibleCount === 0 ? 'block' : 'none';
}

function filterByCategory(category) {
  const posts = document.querySelectorAll('.blog-post');
  const noPostsMessage = document.getElementById('no-posts');
  let visibleCount = 0;

  posts.forEach(post => {
    const categories = (post.dataset.categories || '').split(' ');
    const isVisible = category === 'all' || categories.includes(category);
    
    post.style.display = isVisible ? 'block' : 'none';
    if (isVisible) visibleCount++;
  });

  noPostsMessage.style.display = visibleCount === 0 ? 'block' : 'none';

  // Update active button state
  document.querySelectorAll('[onclick^="filterByCategory"]').forEach(btn => {
    if (btn.textContent.toLowerCase() === category || 
       (btn.textContent === 'All' && category === 'all')) {
      btn.classList.add('bg-pink-600', 'text-white');
      btn.classList.remove('border', 'border-pink-200', 'hover:border-pink-300', 'hover:bg-pink-50');
    } else {
      btn.classList.remove('bg-pink-600', 'text-white');
      btn.classList.add('border', 'border-pink-200', 'hover:border-pink-300', 'hover:bg-pink-50');
    }
  });
}
</script>
{% endblock public_content %}

{% block public_scripts %}{% endblock %}
