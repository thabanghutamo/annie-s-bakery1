{% extends "public/base.html" %}

{% block title %}Products - Annie's Bakery{% endblock %}

{% block public_content %}
<div class="max-w-6xl mx-auto px-4 sm:px-6 py-4 sm:py-6">
  <!-- Category Filter -->
  <div class="mb-6 sm:mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-gray-900 mb-4">Our Products</h1>
      <div class="flex flex-wrap gap-2">
        <button class="px-4 py-2 rounded-full font-medium bg-pink-600 text-white" data-category="all">All</button>
        <button class="px-4 py-2 rounded-full font-medium border border-pink-200 hover:border-pink-300 hover:bg-pink-50" data-category="cakes">Cakes</button>
        <button class="px-4 py-2 rounded-full font-medium border border-pink-200 hover:border-pink-300 hover:bg-pink-50" data-category="pastries">Pastries</button>
        <button class="px-4 py-2 rounded-full font-medium border border-pink-200 hover:border-pink-300 hover:bg-pink-50" data-category="cookies">Cookies</button>
      </div>
    </div>

    <!-- Search Box -->
    <div class="mb-6 sm:mb-8">
      <div class="w-full max-w-md">
        <div class="relative">
          <input type="search" id="product-search" placeholder="Search products..."
                 class="w-full px-4 py-2 pl-10 pr-4 rounded-lg border border-gray-300 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:border-transparent">
          <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
            <svg class="h-5 w-5 text-gray-400" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
              <path fill-rule="evenodd" d="M8 4a4 4 0 100 8 4 4 0 000-8zM2 8a6 6 0 1110.89 3.476l4.817 4.817a1 1 0 01-1.414 1.414l-4.816-4.816A6 6 0 012 8z" clip-rule="evenodd" />
            </svg>
          </div>
        </div>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
      {% for p in products %}
      <div class="bg-white rounded-lg shadow-sm overflow-hidden product-card group hover:shadow-md transition-shadow" 
           data-category="{{ p.category }}"
           data-title="{{ p.title }}"
           data-description="{{ p.short_description or p.description }}">
        <a href="{{ url_for('public.product_detail', product_id=p.id) }}" class="block">
          <div class="relative pb-[75%] sm:pb-[100%]">
            <img class="absolute inset-0 w-full h-full object-cover group-hover:scale-105 transition-transform duration-300" 
                src="{{ p.image or url_for('static', filename='uploads/placeholder.jpg') }}" 
                alt="{{ p.title }}"
                loading="lazy">
          </div>
          <div class="p-3 sm:p-4">
            <h3 class="font-semibold text-gray-900 group-hover:text-pink-600 transition-colors text-base sm:text-lg truncate">{{ p.title }}</h3>
            <p class="text-sm text-gray-600 mt-1 line-clamp-2 sm:line-clamp-3">{{ p.short_description or p.description }}</p>
            <div class="mt-3 flex justify-between items-center">
              <div class="text-lg font-medium text-gray-900">R{{ "%.2f"|format(p.price) }}</div>
              <span class="text-pink-600 hover:text-pink-700 text-sm font-medium">View Details</span>
            </div>
          </div>
        </a>
      </div>
      {% endfor %}
    </div>

    <!-- Empty State -->
    <div id="no-products" class="hidden text-center py-12">
      <h3 class="text-lg font-medium text-gray-900">No products found</h3>
      <p class="mt-2 text-gray-500">Try searching for something else</p>
    </div>
  </div>
{% endblock %}

{% block public_scripts %}
<script>
function addToCart(id, title, price, image) {
  cart.add(id, title, price, image);
}

document.addEventListener('DOMContentLoaded', () => {

  // Product filtering functionality
  const categoryButtons = document.querySelectorAll('[data-category]');
  const products = document.querySelectorAll('.product-card');
  const noProducts = document.getElementById('no-products');
  const searchInput = document.getElementById('product-search');

  // Select 'All' category by default
  document.querySelector('[data-category="all"]').classList.add('bg-pink-600', 'text-white');
  document.querySelector('[data-category="all"]').classList.remove('border', 'border-pink-200', 'hover:border-pink-300', 'hover:bg-pink-50');

  function filterProducts() {
    const selectedCategory = document.querySelector('[data-category].bg-pink-600').dataset.category;
    const searchTerm = searchInput.value.toLowerCase();
    let visibleCount = 0;
    
    products.forEach(product => {
      const matchesCategory = selectedCategory === 'all' || product.dataset.category === selectedCategory;
      const matchesSearch = product.dataset.title.toLowerCase().includes(searchTerm) || 
                           product.dataset.description.toLowerCase().includes(searchTerm);
      
      if (matchesCategory && matchesSearch) {
        product.style.display = 'block';
        visibleCount++;
      } else {
        product.style.display = 'none';
      }
    });

    noProducts.style.display = visibleCount === 0 ? 'block' : 'none';
  }

  // Update category button states
  function updateCategoryButtons(selectedButton) {
    categoryButtons.forEach(btn => {
      if (btn === selectedButton) {
        btn.classList.remove('border', 'border-pink-200', 'hover:border-pink-300', 'hover:bg-pink-50');
        btn.classList.add('bg-pink-600', 'text-white');
      } else {
        btn.classList.remove('bg-pink-600', 'text-white');
        btn.classList.add('border', 'border-pink-200', 'hover:border-pink-300', 'hover:bg-pink-50');
      }
    });
  }

  // Add click handlers to category buttons
  categoryButtons.forEach(button => {
    button.addEventListener('click', () => {
      updateCategoryButtons(button);
      filterProducts();
    });
  });

  // Add search handler
  searchInput.addEventListener('input', filterProducts);
});
</script>
{% endblock %}
